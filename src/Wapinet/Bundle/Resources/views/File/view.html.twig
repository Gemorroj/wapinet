{% extends '::base.html.twig' %}

{% block title %}{% if file is null%}Файл не найден{% else %}{{ file.originalFileName }}{% endif %}{% endblock %}
{% block breadcrumbs %}
    {{wapinet_breadcrumbs({
    1: {'uri': path('downloads'), 'title': 'Загрузки, развлечения'},
    2: {'uri': path('file_index'), 'title': 'Файлообменник'}
    })}}
{% endblock %}

{% block javascripts %}
    {% if file is not null %}
        {% if file.isPlayableVideo %}
            <script type="text/javascript">
                {% include '@Wapinet/video.js.twig' with {'file': file} %}
            </script>
        {% elseif file.isPlayableAudio %}
            <script type="text/javascript">
                {% include '@Wapinet/audio.js.twig' with {'file': file} %}
            </script>
        {% endif %}
    {% endif %}
{% endblock %}

{% block content %}
    {% if file is null%}
        Файл не найден
    {% else %}
        <p><a data-role="button" href="{{ vich_uploader_asset(file, 'file') }}" download="{{ file.originalFileName }}">Скачать</a></p>
        {% if file.user is not null %}
            <p>Загружено: <a href="{{ path('wapinet_user_profile', {'username': file.user.username}) }}">{{ file.user.username }}</a></p>
        {% endif %}
        <p>Просмотров: {{ file.countViews }}</p>
        {% if file.isImage %}
            {% set info = wapinet_image_info(file.file) %}
            {% if info is not null %}
                {% include 'WapinetBundle::image.html.twig' with {'image': {'id': file.id, 'alt': file.originalFileName, 'src': vich_uploader_asset(file, 'file') } } %}
            {% endif %}
            <p>{{ file.file.size|wapinet_size }}{% if info is not null %}, {{ info.size.width }}x{{ info.size.height }}{% endif %}</p>
        {% elseif file.isVideo %}
            {% set info = wapinet_video_info(file.file) %}
            {% set screenshot = vich_uploader_asset(file, 'file')|wapinet_video_screenshot %}
            {% if file.isPlayableVideo %}
                {% include '@Wapinet/video.html.twig' with {'file': file} %}
            {% else %}
                {% if screenshot is not null %}
                    {% include 'WapinetBundle::image.html.twig' with {'image': {'id': file.id, 'alt': file.originalFileName, 'src': screenshot } } %}
                {% endif %}
            {% endif %}
            <p>{{ file.file.size|wapinet_size }}{% if info is not null %}, {{ info.dimensions.width }}x{{ info.dimensions.height }}{{ info.has('duration') ? ', ' ~ info.get('duration')|wapinet_length : '' }}{% endif %}</p>
        {% elseif file.isAudio %}
            {% set info = wapinet_audio_info(file.file) %}
            {% if file.isPlayableAudio %}
                {% include '@Wapinet/audio.html.twig' with {'file': file} %}
            {% endif %}
            <p>{{ file.file.size|wapinet_size }}{% if info is not null %}{{ info.has('duration') ? ', ' ~ info.get('duration')|wapinet_length : '' }}{% endif %}</p>
        {% elseif file.isArchive %}
            <p>{{ file.file.size|wapinet_size }}</p>
            {% if file.isExtractableArchive %}
                {% include '@Wapinet/archive.html.twig' with {'file': file} %}
            {% endif %}
        {% else %}
            <p>{{ file.file.size|wapinet_size }}</p>
        {% endif %}
    {% endif %}
{% endblock %}
