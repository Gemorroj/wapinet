{% set format %}{% spaceless %}
    {% if file.isM4v or file.is3gp %}
        m4v
    {% elseif file.isOgv %}
        ogv
    {% elseif file.isWebmv or file.isAvi %}
        webmv
    {% elseif file.isFlv %}
        flv
    {% endif %}
{% endspaceless %}{% endset %}

{% set video %}{% spaceless %}
    {% if file.is3gp %}
        {{ vich_uploader_asset(file, 'file')|wapinet_video_3gp_to_mp4 }}
    {% elseif file.isAvi %}
        {{ vich_uploader_asset(file, 'file')|wapinet_video_avi_to_webm }}
    {% else %}
        {{ vich_uploader_asset(file, 'file') }}
    {% endif %}
{% endspaceless %}{% endset %}

{% set screenshot = vich_uploader_asset(file, 'file')|wapinet_video_screenshot %}

$(document).ready(function () {
    {% if video %}
        $("#jquery_jplayer_1").jPlayer({
            "ready": function () {
                $(this).jPlayer("setMedia", {
                    {% if screenshot is not null %}
                        "poster": "{{ screenshot }}",
                    {% endif %}
                    "{{ format }}": "{{ video }}"
                });
            },
            "supplied": "{{ format }}",
            "swfPath": "{{ asset('bundles/wapinet/jplayer/Jplayer.swf') }}"
        });
    {% else %}
        $("#jp_container_1").hide();
    {% endif %}
});

